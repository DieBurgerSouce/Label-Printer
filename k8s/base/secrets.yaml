# Kubernetes Secrets Configuration
# Enterprise secrets management for Screenshot_Algo
#
# IMPORTANT: This file contains ONLY placeholder references.
# DO NOT commit actual secrets to version control!
#
# For production, use one of these approaches:
# 1. External Secrets Operator (recommended) - see ExternalSecret below
# 2. Sealed Secrets (Bitnami)
# 3. HashiCorp Vault with Vault Secrets Operator
# 4. CI/CD pipeline secret injection
#
# The placeholder Secret below is for LOCAL DEVELOPMENT ONLY.
# It will be replaced by External Secrets in staging/production.
---
# Development-only Secret (do NOT use in production)
# This is intentionally left with placeholder markers to fail fast if used
apiVersion: v1
kind: Secret
metadata:
  name: screenshot-algo-secrets
  namespace: screenshot-algo
  labels:
    app.kubernetes.io/name: screenshot-algo
    app.kubernetes.io/component: secrets
    app.kubernetes.io/managed-by: kustomize
  annotations:
    # Mark as development-only
    environment: development
    warning: "PLACEHOLDER VALUES - Replace with External Secrets in production"
type: Opaque
stringData:
  # These are PLACEHOLDER markers - they will cause the app to fail
  # if not properly configured, which is intentional for safety
  DATABASE_URL: "${DATABASE_URL:?Error: DATABASE_URL not configured}"
  REDIS_URL: "${REDIS_URL:?Error: REDIS_URL not configured}"
  JWT_SECRET: "${JWT_SECRET:?Error: JWT_SECRET not configured}"
  API_SECRET_KEY: "${API_SECRET_KEY:?Error: API_SECRET_KEY not configured}"
  SENTRY_DSN: ""  # Optional: Empty is valid (disables Sentry)
---
# External Secrets Operator Configuration (RECOMMENDED for production)
# Requires: External Secrets Operator installed in cluster
# Install: helm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: screenshot-algo-external
  namespace: screenshot-algo
  labels:
    app.kubernetes.io/name: screenshot-algo
    app.kubernetes.io/component: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager  # or: vault, gcp-secrets, azure-keyvault
    kind: ClusterSecretStore
  target:
    name: screenshot-algo-secrets
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    # Database
    - secretKey: DATABASE_URL
      remoteRef:
        key: screenshot-algo/database
        property: url
    # Redis
    - secretKey: REDIS_URL
      remoteRef:
        key: screenshot-algo/redis
        property: url
    # JWT
    - secretKey: JWT_SECRET
      remoteRef:
        key: screenshot-algo/jwt
        property: secret
    # API Key
    - secretKey: API_SECRET_KEY
      remoteRef:
        key: screenshot-algo/api
        property: secret_key
    # Sentry (optional)
    - secretKey: SENTRY_DSN
      remoteRef:
        key: screenshot-algo/sentry
        property: dsn
---
# TLS Secret for Ingress
# In production, use cert-manager for automatic certificate management
# Install cert-manager: kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.0/cert-manager.yaml
apiVersion: v1
kind: Secret
metadata:
  name: screenshot-algo-tls
  namespace: screenshot-algo
  labels:
    app.kubernetes.io/name: screenshot-algo
    app.kubernetes.io/component: tls
  annotations:
    cert-manager.io/issuer-name: letsencrypt-prod
    cert-manager.io/issuer-kind: ClusterIssuer
type: kubernetes.io/tls
data:
  # Managed by cert-manager - leave empty
  # cert-manager will populate these automatically
  tls.crt: ""
  tls.key: ""
